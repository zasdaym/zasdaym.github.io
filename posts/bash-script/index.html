<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Bash script tips | zasdaym</title>
<meta name=keywords content>
<meta name=description content="For some small tasks, sometimes Bash script (shell script in general) is better than a full-blown program using programming languages. Here&rsquo;s some personal tips to write a Bash script:
Exit on fail Use set -o errexit to make the script exit when it fails. If some commands are allowed to fail, command1 || echo &#34;command1 is failed, but continuing&#34; can be used.
Prevent access to undeclared variables Use set -o nounset to exit when the script tries to use undeclared variables.">
<meta name=author content>
<link rel=canonical href=https://zasdaym.github.io/posts/bash-script/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.35cd0f65a15cafa92372b8313deef5960aae04b90ad722f2bbf509eb0468137e.css integrity="sha256-Nc0PZaFcr6kjcrgxPe71lgquBLkK1yLyu/UJ6wRoE34=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://zasdaym.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://zasdaym.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://zasdaym.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://zasdaym.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://zasdaym.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.89.4">
<meta property="og:title" content="Bash script tips">
<meta property="og:description" content="For some small tasks, sometimes Bash script (shell script in general) is better than a full-blown program using programming languages. Here&rsquo;s some personal tips to write a Bash script:
Exit on fail Use set -o errexit to make the script exit when it fails. If some commands are allowed to fail, command1 || echo &#34;command1 is failed, but continuing&#34; can be used.
Prevent access to undeclared variables Use set -o nounset to exit when the script tries to use undeclared variables.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://zasdaym.github.io/posts/bash-script/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-07-20T17:03:22+07:00">
<meta property="article:modified_time" content="2021-07-20T17:03:22+07:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Bash script tips">
<meta name=twitter:description content="For some small tasks, sometimes Bash script (shell script in general) is better than a full-blown program using programming languages. Here&rsquo;s some personal tips to write a Bash script:
Exit on fail Use set -o errexit to make the script exit when it fails. If some commands are allowed to fail, command1 || echo &#34;command1 is failed, but continuing&#34; can be used.
Prevent access to undeclared variables Use set -o nounset to exit when the script tries to use undeclared variables.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zasdaym.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Bash script tips","item":"https://zasdaym.github.io/posts/bash-script/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Bash script tips","name":"Bash script tips","description":"For some small tasks, sometimes Bash script (shell script in general) is better than a full-blown program using programming languages. Here\u0026rsquo;s some personal tips to write a Bash script:\nExit on fail Use set -o errexit to make the script exit when it fails. If some commands are allowed to fail, command1 || echo \u0026quot;command1 is failed, but continuing\u0026quot; can be used.\nPrevent access to undeclared variables Use set -o nounset to exit when the script tries to use undeclared variables.","keywords":[],"articleBody":"For some small tasks, sometimes Bash script (shell script in general) is better than a full-blown program using programming languages. Here’s some personal tips to write a Bash script:\nExit on fail Use set -o errexit to make the script exit when it fails. If some commands are allowed to fail, command1 || echo \"command1 is failed, but continuing\" can be used.\nPrevent access to undeclared variables Use set -o nounset to exit when the script tries to use undeclared variables. Imagine running this command when undeclared variables is allowed:\nrm -rf ${base_folder}/* When the variable $base_folder is not set, it will become rm -rf /*. If some variables are allowed to be undeclared, use ${variable_name:default_value} to set $variable_name to default_value when it’s not declared.\nIdempotency What is idempotency?\n Idempotence is the property of certain operations in mathematics and computer science whereby they can be applied multiple times without changing the result beyond the initial application.\n In short, it means that idempotent Bash scripts should have the same effects on the system even when called multiple times. Some example of idempotency in Bash script:\nCreating a symbolic link The basic syntax of creating a symbolic link is:\nln -s source target This is not idempotent, it will fail in the second run because the target is already exists. It can be solved by adding the -f flag:\nln -sf source target If executed multiple times, it’s still not idempotent because it will create a symbolic link inside the previously created symbolic link (nested). The idempotent way to create a symbolic link is:\nln -sfn source target Removing a file The command rm filename will fail if the file is not exists, use rm -f instead. To remove folder, use rm -rf.\nCheck if a file exists Common usage is to download a file if only its not exist:\nif [[ ! -f ${HOME}/.local/bin/random_binary ]]; then wget -qO ${HOME}/.local/bin/random_binary https://randomsite.com/random_binary fi Use curly brace to when using variables When using variables inside a string, sometimes it’s clearer to access the variable with the curly brace. So instead of this:\necho \"$var1_new.yaml\" Prefer this:\necho \"${var1}_new.yaml\" So it’s clear that the variable name is var1, not var1_new.\n","wordCount":"365","inLanguage":"en","datePublished":"2021-07-20T17:03:22+07:00","dateModified":"2021-07-20T17:03:22+07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://zasdaym.github.io/posts/bash-script/"},"publisher":{"@type":"Organization","name":"zasdaym","logo":{"@type":"ImageObject","url":"https://zasdaym.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<noscript>
<style type=text/css>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://zasdaym.github.io/ accesskey=h title="zasdaym (Alt + H)">zasdaym</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://zasdaym.github.io/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Bash script tips
</h1>
<div class=post-meta>July 20, 2021
</div>
</header>
<div class=post-content><p>For some small tasks, sometimes Bash script (shell script in general) is better than a full-blown program using programming languages. Here&rsquo;s some personal tips to write a Bash script:</p>
<h2 id=exit-on-fail>Exit on fail<a hidden class=anchor aria-hidden=true href=#exit-on-fail>#</a></h2>
<p>Use <code>set -o errexit</code> to make the script exit when it fails. If some commands are allowed to fail, <code>command1 || echo "command1 is failed, but continuing"</code> can be used.</p>
<h2 id=prevent-access-to-undeclared-variables>Prevent access to undeclared variables<a hidden class=anchor aria-hidden=true href=#prevent-access-to-undeclared-variables>#</a></h2>
<p>Use <code>set -o nounset</code> to exit when the script tries to use undeclared variables. Imagine running this command when undeclared variables is allowed:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>rm -rf <span style=color:#e6db74>${</span>base_folder<span style=color:#e6db74>}</span>/*
</code></pre></div><p>When the variable <code>$base_folder</code> is not set, it will become <code>rm -rf /*</code>.
If some variables are allowed to be undeclared, use <code>${variable_name:default_value}</code> to set <code>$variable_name</code> to <code>default_value</code> when it&rsquo;s not declared.</p>
<h2 id=idempotency>Idempotency<a hidden class=anchor aria-hidden=true href=#idempotency>#</a></h2>
<p>What is idempotency?</p>
<blockquote>
<p>Idempotence is the property of certain operations in mathematics and computer science whereby they can be applied multiple times without changing the result beyond the initial application.</p>
</blockquote>
<p>In short, it means that idempotent Bash scripts should have the same effects on the system even when called multiple times. Some example of idempotency in Bash script:</p>
<h3 id=creating-a-symbolic-link>Creating a symbolic link<a hidden class=anchor aria-hidden=true href=#creating-a-symbolic-link>#</a></h3>
<p>The basic syntax of creating a symbolic link is:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ln -s source target
</code></pre></div><p>This is not idempotent, it will fail in the second run because the target is already exists. It can be solved by adding the <code>-f</code> flag:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ln -sf source target
</code></pre></div><p>If executed multiple times, it&rsquo;s still not idempotent because it will create a symbolic link inside the previously created symbolic link (nested). The idempotent way to create a symbolic link is:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ln -sfn source target
</code></pre></div><h3 id=removing-a-file>Removing a file<a hidden class=anchor aria-hidden=true href=#removing-a-file>#</a></h3>
<p>The command <code>rm filename</code> will fail if the file is not exists, use <code>rm -f</code> instead. To remove folder, use <code>rm -rf</code>.</p>
<h2 id=check-if-a-file-exists>Check if a file exists<a hidden class=anchor aria-hidden=true href=#check-if-a-file-exists>#</a></h2>
<p>Common usage is to download a file if only its not exist:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! -f <span style=color:#e6db74>${</span>HOME<span style=color:#e6db74>}</span>/.local/bin/random_binary <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
  wget -qO <span style=color:#e6db74>${</span>HOME<span style=color:#e6db74>}</span>/.local/bin/random_binary https://randomsite.com/random_binary
<span style=color:#66d9ef>fi</span>
</code></pre></div><h2 id=use-curly-brace-to-when-using-variables>Use curly brace to when using variables<a hidden class=anchor aria-hidden=true href=#use-curly-brace-to-when-using-variables>#</a></h2>
<p>When using variables inside a string, sometimes it&rsquo;s clearer to access the variable with the curly brace. So instead of this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>echo <span style=color:#e6db74>&#34;</span>$var1_new<span style=color:#e6db74>.yaml&#34;</span>
</code></pre></div><p>Prefer this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>echo <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>var1<span style=color:#e6db74>}</span><span style=color:#e6db74>_new.yaml&#34;</span>
</code></pre></div><p>So it&rsquo;s clear that the variable name is <code>var1</code>, not <code>var1_new</code>.</p>
</div>
<footer class=post-footer>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://zasdaym.github.io/>zasdaym</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)">
<button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</button>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>